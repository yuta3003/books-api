# コーディング規約

- **フォーマッタ**: `isort` → `black` の順で実行し、差分はフォーマット後のもののみをコミットする
- **型ヒント**: 可能な限り付与し、返り値/引数の型が曖昧な関数は避ける
- **命名**:
  - 変数/関数は `snake_case`、クラスは `PascalCase`
  - ルータ/パスは名詞の複数形を基本にする（例: `/books`, `/authors`）
  - 定数は `UPPER_SNAKE_CASE`、Enumは `PascalCase` を基本にする
- **構造**:
  - ルータ/サービス/リポジトリ（DB）を分離し、責務が混ざらないようにする
  - DBアクセスは `api/cruds` に集約し、ハンドラで直接クエリを書かない
  - ルータは `api/routers`、モデルは `api/models`、スキーマは `api/schemas` に置く
  - ルータはI/Oの変換と依存注入までに留め、ビジネスロジックはサービス側に寄せる
- **例外/エラー**:
  - 例外は握りつぶさず、適切なHTTPステータスとメッセージで返す
  - 予期しない例外はログに記録し、API仕様に沿ったレスポンスにする
  - エラーレスポンスは `detail`（人向け）と `code`（機械判定用）を持つ
  - 例外の共通化は `api/exceptions` に集約し、ルータから直接 `HTTPException` を乱立させない
- **ログ**:
  - デバッグ用の`print`は使用しない
  - 重要な処理・失敗時は構造化ログ（キー・バリュー）で残す
  - `logging.getLogger(__name__)` を使い、`extra` で `request_id` などを渡す
- **テスト**:
  - 新機能には対応するテストを追加
  - 不具合修正は再現テストを追加してから修正する
  - `pytest` を前提に `tests/` 配下へ `test_*.py` で配置する
  - Arrange-Act-Assert を意識し、1テスト1観点を守る
- **ドキュメント**:
  - API 変更時は README を更新
  - 重要な仕様や判断理由は `docs/` に記録する
